<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIN Customer Profiles</title>
<style>
  body { font-family: Arial; margin:0; padding:0; background:#f4f4f4; }
  .container { max-width:900px; margin:auto; padding:20px; background:#fff; border-radius:10px; }
  input, button { padding:10px; margin:5px 0; width:100%; border-radius:5px; border:1px solid #ccc; }
  table { width:100%; border-collapse: collapse; margin-top:20px; }
  th, td { border:1px solid #ccc; padding:10px; text-align:left; }
  th { background:#eee; }
</style>
</head>
<body>
<div class="container">
<h2>VIN Customer Profiles</h2>

<label>Customer Name:</label>
<input type="text" id="customerName" placeholder="Full Name">

<label>Phone Number:</label>
<input type="text" id="phone" placeholder="Phone Number">

<label>Email:</label>
<input type="text" id="email" placeholder="Email">

<label>Plate Number:</label>
<input type="text" id="plate" placeholder="Plate Number">

<label>VIN Number:</label>
<input type="text" id="vin" placeholder="Enter VIN">

<button onclick="decodeVin()">Decode VIN & Save</button>

<h3>Search Customer</h3>
<input type="text" id="searchInput" placeholder="Search by Name, VIN, or Plate" oninput="searchProfiles()">

<h3>Saved Profiles</h3>
<table id="profilesTable">
<tr>
<th>Customer</th><th>Phone</th><th>Email</th><th>Plate</th><th>VIN</th><th>Vehicle Info</th><th>Actions</th>
</tr>
</table>
</div>

<script>
let profiles = JSON.parse(localStorage.getItem("profiles") || "[]");
let editingIndex = null;

function loadProfiles(){
  const table = document.getElementById("profilesTable");
  table.innerHTML = `<tr>
<th>Customer</th><th>Phone</th><th>Email</th><th>Plate</th><th>VIN</th><th>Vehicle Info</th><th>Actions</th>
</tr>`;
  profiles.forEach((p,i)=>addRow(p,i));
}

function addRow(profile,index){
  const table=document.getElementById("profilesTable");
  const row=table.insertRow();
  row.insertCell(0).innerText=profile.name;
  row.insertCell(1).innerText=profile.phone;
  row.insertCell(2).innerText=profile.email;
  row.insertCell(3).innerText=profile.plate;
  row.insertCell(4).innerText=profile.vin;
  row.insertCell(5).innerText=profile.vehicleInfo;
  const actions=row.insertCell(6);

  const editBtn=document.createElement("button");
  editBtn.innerText="Edit";
  editBtn.onclick=()=>editProfile(index);
  actions.appendChild(editBtn);

  const delBtn=document.createElement("button");
  delBtn.innerText="Delete";
  delBtn.onclick=()=>deleteProfile(index);
  actions.appendChild(delBtn);
}

async function decodeVin(){
  const vin=document.getElementById("vin").value.trim();
  if(!vin){ alert("Enter VIN"); return; }

  let vehicleInfo="";
  try{
    const res=await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${vin}?format=json`);
    const data=await res.json();
    const result=data.Results[0];
    vehicleInfo=`${result.ModelYear} ${result.Make} ${result.Model}`;
  }catch{
    vehicleInfo="Could not decode VIN";
  }

  const profile={
    name:document.getElementById("customerName").value,
    phone:document.getElementById("phone").value,
    email:document.getElementById("email").value,
    plate:document.getElementById("plate").value,
    vin,
    vehicleInfo
  };

  if(editingIndex!==null){ profiles[editingIndex]=profile; editingIndex=null;}
  else{ profiles.push(profile);}

  localStorage.setItem("profiles",JSON.stringify(profiles));
  loadProfiles();

  // Clear fields
  document.getElementById("customerName").value="";
  document.getElementById("phone").value="";
  document.getElementById("email").value="";
  document.getElementById("plate").value="";
  document.getElementById("vin").value="";
}

function editProfile(index){
  const p=profiles[index];
  document.getElementById("customerName").value=p.name;
  document.getElementById("phone").value=p.phone;
  document.getElementById("email").value=p.email;
  document.getElementById("plate").value=p.plate;
  document.getElementById("vin").value=p.vin;
  editingIndex=index;
}

function deleteProfile(index){
  if(confirm("Delete this profile?")){
    profiles.splice(index,1);
    localStorage.setItem("profiles",JSON.stringify(profiles));
    loadProfiles();
  }
}

function searchProfiles(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const filtered=profiles.filter(p=>p.name.toLowerCase().includes(q)||p.vin.toLowerCase().includes(q)||p.plate.toLowerCase().includes(q));
  const table=document.getElementById("profilesTable");
  table.innerHTML=`<tr>
<th>Customer</th><th>Phone</th><th>Email</th><th>Plate</th><th>VIN</th><th>Vehicle Info</th><th>Actions</th>
</tr>`;
  filtered.forEach((p,i)=>addRow(p,i));
}

loadProfiles();
</script>
</body>
</html>
